import{jsxRuntimeExports as e,reactExports as t}from"./vendor-Cyl74405.es.js";import{useSduiExpression as i,useSduiStore as a,CROP_RATIOS as n,MediaImageEditor as r,filesWithEditDataToMediaList as o,MEDIA_EDITOR_VIEW as l,CropRatio as d,clientMediaFileStore as s,renderImageWithEdits as m,CROP_RATIOS$1 as c,useMediaImageEditor as p,getFileUrl as g,MediaEditData as u,MediaImageEditorCanvas as C,MediaEditorToolbar as f,MediaFileManager as E,MediaEditorViewWrapper as I,MediaImageFilters as _,MediaAltTextEditor as R,AddImage as y}from"./sdui-a_St44eH.es.js";import{useI18n as h,useTrackingContext as j}from"./como-xk_MJztB.es.js";import{Box as x,Image as A,Column as F,Button as O}from"./ui-EQ1jb761.es.js";/* empty css                    */import"./delux-sortable-DxyLPFYN.es.js";let b=Object.freeze(Object.defineProperty({__proto__:null,MediaEditor:function({input:t,editorConfig:l,outputMediaList:d,onComplete:s}={}){let m=i(t),c=i(l?.enableImageFilters),p=i(l?.enableImageAdjustmentSliders),{setValue:g}=a(),u=n[l?.supportedCropRatios?.[0]??"CropRatio_Original"]||n.CropRatio_Original;return e.jsx("div",{children:e.jsx(r,{input:m?.mediaFiles?.[0],onComplete:(e,t)=>{if(!m||!m.mediaFiles)return;let i=o([{file:e,editData:t}]);d?.key&&i&&g(d?.key,i),s?.()},enableImageFilters:c,enableImageAdjustmentSliders:p,cropRatio:u})})}},Symbol.toStringTag,{value:"Module"})),T=Object.freeze(Object.defineProperty({__proto__:null,MediaEditor:function({input:n,editorConfig:r,outputMediaList:b,onComplete:T,tagEditor:M}={}){let[v,w]=t.useState(l.FILE_MANAGER),k=i(n),[N,L]=t.useState(0),[S,G]=t.useState(k?.mediaFiles??[]),D=i(r?.enableImageFilters),P=i(r?.enableImageAdjustmentSliders),{setValue:U}=a(),{t:B}=h(),{jetCore:z}=j().getClients(),W=t.useRef(new Map),[K,V]=t.useState(()=>new Map),[Z,X]=t.useState(r?.supportedCropRatios?.[0]??d.CropRatio_Original),Y=c[Z]||c[d.CropRatio_Original],$=t.useCallback(async e=>{let t;if(!S.length)return;let i=S[N];if(!i)return;W.current.set(i.mediaFileId,e);let a=s.getItem(i.mediaFileId);if(a)try{let n=await m(a,e,Y),r=K.get(i.mediaFileId);r&&URL.revokeObjectURL(r),t=URL.createObjectURL(n),V(e=>{let a=new Map(e);return a.set(i.mediaFileId,t),a})}catch(e){z.reportError(Error("Failed to generate image preview in MediaEditor",{cause:e}),["media-editor-v2"])}let n=[...S];return n[N]={...i,editData:e},G(n),t},[S,N,Y,K,z]),H=S[N],J=H?W.current.get(H.mediaFileId):void 0;t.useEffect(()=>{if(H&&v===l.IMAGE_EDITOR){let e=W.current.get(H.mediaFileId);X(e?.cropRatio??r?.supportedCropRatios?.[0]??d.CropRatio_Original)}},[H,v,r?.supportedCropRatios]);let[Q,q]=p(H,Y,J,t.useCallback(async e=>{let t=await $(e);t&&"undefined"!=typeof document&&await new Promise(e=>{let i=document.createElement("img");i.onload=()=>e(),i.onerror=()=>e(),i.src=t}),w(l.FILE_MANAGER)},[$])),ee=H?K.get(H.mediaFileId)||g(H):void 0,et=u.create(),ei=e=>{if(!e||0===e.length)return;let t=[...S,...e.map(e=>{let t=crypto.randomUUID(),i=e.webkitRelativePath||t;return s.setItem(t,e),i!==t&&s.setItem(i,e),{metadata:void 0,fileName:e.name,source:{$case:"localFile",localFile:{fileName:e.name,mimeType:e.type,filePointer:i}},size:e.size.toString(),mimeType:e.type,filePointer:i,mediaFileId:t,editData:et,captions:[],thumbnails:[]}})];G(t),L(t.length-1),b?.key&&U(b.key,{mediaFiles:t}),w(l.FILE_MANAGER)},ea=t.useRef(K);ea.current=K,t.useEffect(()=>()=>{ea.current.forEach(e=>{URL.revokeObjectURL(e)})},[]);let en=t.useCallback(async()=>{let e=await Promise.all(S.map(async e=>{let t=W.current.get(e.mediaFileId);if(!t)return e;let i=s.getItem(e.mediaFileId);if(!i)return e;try{let a=await m(i,t,Y),n=o([{file:a,editData:t}]);return n?.mediaFiles?.[0]||e}catch(t){return z.reportError(Error("Failed to render image with edits during save",{cause:t}),["media-editor-v2"]),e}}));b?.key&&e.length>0&&U(b.key,{$type:"proto.sdui.media.MediaList",mediaFiles:e}),T?.()},[S,Y,b?.key,U,T,z]);return e.jsxs(x,{display:"grid",style:{height:"100%",gridTemplateColumns:"4fr 2fr",gridTemplateRows:"1fr auto"},children:[e.jsxs(x,{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:v===l.IMAGE_EDITOR?void 0:"tableBackgroundOffset",style:{gridColumn:"1",gridRow:"1",overflow:"hidden"},children:[e.jsx(x,{display:v===l.IMAGE_EDITOR?"none":"flex",justifyContent:"center",alignItems:"center",width:"fillAvailable",height:"fillAvailable",children:e.jsx(A,{src:ee,a11yText:B("media_editor_image_preview"),imageScalingType:"contain",width:"100%",height:"100%"})}),v===l.IMAGE_EDITOR&&e.jsx(C,{canvasKey:Q.canvasKey,onReady:Q.onReady,hasContentCredentials:Q.hasContentCredentials,isImageEdited:Q.isImageEdited,isContentCredentialsTooltipOpen:Q.isContentCredentialsTooltipOpen,setIsContentCredentialsTooltipOpen:Q.setIsContentCredentialsTooltipOpen,isContentCredentialsWarningOpen:Q.isContentCredentialsWarningOpen,setIsContentCredentialsWarningOpen:Q.setIsContentCredentialsWarningOpen})]}),v===l.FILE_MANAGER&&e.jsx(x,{display:"flex",justifyContent:"center",backgroundColor:"tableBackgroundOffset",style:{gridColumn:"1",gridRow:"2"},children:e.jsx(f,{activeView:v,onViewChange:w,selectedFile:H})}),e.jsx(x,{inset:"2x",display:"flex",flexDirection:"column",style:{gridColumn:"2",gridRow:"1 / 3",overflow:"auto"},children:e.jsxs(F,{gap:"2x",height:"100%",children:[v===l.FILE_MANAGER&&e.jsx(E,{files:S,selectedIndex:N,onSelectionChange:L,onFilesChange:G,onFilesAdded:ei,onViewChange:e=>w(e),previewUrlMap:K}),v===l.IMAGE_EDITOR&&e.jsx(I,{title:B("media_editor_edit"),onBack:()=>w(l.FILE_MANAGER),children:e.jsx(_,{imageRef:Q.imageRef,editData:Q.editData,initialZoom:Q.initialZoom,initialStraightenAngle:Q.initialStraightenAngle,initialRotate:Q.initialRotate,onEdit:Q.onImageEdit,onConstrainPosition:Q.constrainImagePosition,enableImageFilters:D,enableImageAdjustmentSliders:P,onApplyEdits:q,onCropRatioChange:X,supportedCropRatios:r?.supportedCropRatios,originalScale:Q.originalScale})}),v===l.TAG_EDITOR&&e.jsx(I,{title:B("media_editor_add_tag"),onBack:()=>w(l.FILE_MANAGER),children:M}),v===l.ALT_TEXT_EDITOR&&e.jsx(I,{title:B("media_editor_add_alt_text"),onBack:()=>w(l.FILE_MANAGER),children:e.jsx(R,{initialAltText:H?.metadata?.altText,onSave:e=>{H&&(G(S.map(t=>t.mediaFileId===H.mediaFileId?{...t,metadata:{...t.metadata,altText:e}}:t)),w(l.FILE_MANAGER))}})}),v===l.ADD_IMAGE&&e.jsx(I,{onBack:()=>w(l.FILE_MANAGER),children:e.jsx(y,{onFilesAdded:ei,onViewChange:w})})]})}),e.jsx(x,{borderTop:"divider",insetX:"3x",insetY:"1.5x",tagName:"footer",justifyContent:"flexEnd",display:"flex",style:{gridColumn:"1 / 4",gridRow:"3"},children:e.jsx(O,{category:"primary",isEmphasized:!0,onClick:en,text:B("media_editor_save")})})]})}},Symbol.toStringTag,{value:"Module"}));export{b as CLIENT_COMPONENT_36610642f83d7097c7cf4dceb774deeb,T as CLIENT_COMPONENT_e66676ac1c1e334826be4ab8460d7536};